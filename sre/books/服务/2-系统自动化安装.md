# 应答文件生成
```bash
#网络服务器和key操控机都在10.0.0.200
# 安装生成软件
yum install system-config-kickstart.noarch 
#开始配置
system-config-kickstart
# 脚本
#配置key验证
mkdir -p /root/.ssh
cat >/root/.ssh/authorized_keys<<EOF
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDlcmRPDFWZfV5EHq7swnbcgyh5attjJZEpkryZpfk3xQi85Cvp4T/S0a3YASg5rCZNXm9OTwgxo4UhAB2lZMjODQSv3+AG+o/7tYq9BjDWfn2AWzcxw3dmQLm0i5glH5uJQb7BAgQdC0Qv6SLvXmomwWN1B8rwsmmMNi0+nI+sclwMSbIfynn2lpqjXHH9A2+FuZr/bnheRfrQHeneXOUzAn+s64aDZoajEUxExtkUJx2RMzH3j1qH9twWoQCnyT0viBF5iXsp52ISVCsFdNVsa9aD5gnxZp8lU6/I4Rx736YoSBn8n0FkBNYwh7D86IN6QicUwUoeqDHGSa8f5HFz root@oldboy-study-lvyusen
EOF
chomd  600 /root/.ssh/authorized_keys
#配置yum源
mkdir -p /etc/yum.repos.d/bak
mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak
cat >test<<EOF
[base]
name=Centos_yum.repos
baseurl=http://10.0.0.200/centos/$releasever/os/$basearch/
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7
EOF

# 检查应答文件格式是否正确
ksvalidator /root/ks_7_min.cfg 

#把应答文件放网络上
mv /root/ks_7_min.cfg /var/www/html/ksdir/

# 最小化安装
%packages
@^minimal
@compat-libraries
@core
@debugging
@development
%end
```
# 最终生成的文件
```bash
#platform=x86, AMD64, 或 Intel EM64T
#version=DEVEL
# Install OS instead of upgrade
install
# Keyboard layouts
keyboard 'us'
# Root password
rootpw --iscrypted $1$KSs.jO3p$SBDGLLjTccH4dTH5OPf7l.
# System language
lang en_US
# System authorization information
auth  --useshadow  --passalgo=sha512
# Use text mode install
text
firstboot --disable
# SELinux configuration
selinux --disabled

%packages
@^minimal
@compat-libraries
@core
@debugging
@development
%end

# Firewall configuration
firewall --disabled
# Network information
network  --bootproto=dhcp --device=eth0
# Reboot after installation
reboot
# System timezone
timezone Africa/Abidjan
# Use network installation
url --url="http://10.0.0.200/centos/7/os/x86_64"
# System bootloader configuration
bootloader --append="net.ifnames=0" --location=mbr
# Partition clearing information
clearpart --all
# Disk partitioning information
part /boot --fstype="xfs" --size=1000
part / --fstype="xfs" --size=10000
part swap --fstype="swap" --size=2000

%post
mkdir -p /root/.ssh
cat >/root/.ssh/authorized_keys<<EOF
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDlcmRPDFWZfV5EHq7swnbcgyh5attjJZEpkryZpfk3xQi85Cvp4T/S0a3YASg5rCZNXm9OTwgxo4UhAB2lZMjODQSv3+AG+o/7tYq9BjDWfn2AWzcxw3dmQLm0i5glH5uJQb7BAgQdC0Qv6SLvXmomwWN1B8rwsmmMNi0+nI+sclwMSbIfynn2lpqjXHH9A2+FuZr/bnheRfrQHeneXOUzAn+s64aDZoajEUxExtkUJx2RMzH3j1qH9twWoQCnyT0viBF5iXsp52ISVCsFdNVsa9aD5gnxZp8lU6/I4Rx736YoSBn8n0FkBNYwh7D86IN6QicUwUoeqDHGSa8f5HFz root@oldboy-study-lvyusen
EOF
chmod  600 /root/.ssh/authorized_keys
mkdir -p /etc/yum.repos.d/bak
mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak
cat >/etc/yum.repos.d/test<<EOF
[base]
name=Centos_yum.repos
baseurl=http://10.0.0.200/centos/$releasever/os/$basearch/
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7
EOF
%end
```
# 应答文件给安装向导使用
```bash
1.启动虚拟机，按esc键，进入boot
2.输入 linux ks=http://10.0.0.200/ksdir/ks_7_min.cfg ip=10.0.0.240 netmask=255.255.255.0 #有dhcp就不用ip和netmask
```
# DHCP
![image.png](https://lvyusen-1316126434.cos.ap-guangzhou.myqcloud.com/images/202501200651350.png?imageSlim)
```bash
# dhcp服务器配置
yum install -y dhcp
# dhcp配置文件，默认为空
cat /etc/dhcp/dhcpd.conf
# 配置文件范例
cp /usr/share/doc/dhcp(版本)/dhcpd.conf.example /etc/dhcp/dhcpd.conf
#修改配置文件
	#配置可用地址范围，网关
	subnet 10.0.0.0  netmask 255.255.255.0 {
	  range 10.0.0.50 10.0.0.100;
	  option routers 10.0.0.1;
	}
	#配置dns
	option domain-name "lvyusen.com";
	option domain-name-servers 223.5.5.5; # dns服务器
	# 配置租期
	default-lease-time 600; #默认十分钟
	max-lease-time 7200; # 最长2小时
	


#服务器查看dhcp分发ip记录
cat /var/lib/dhcpd/dhcpd.leases
#客户端查看获取dhcp记录
cat /var/lib/dhclient/
```
