# 磁盘组成
+ 磁头
+ 磁面
+ 磁道
+ 扇区
# CHS寻址
	早期磁盘使用CHS寻址，以8位表示磁头、10位表示磁面，6位表示扇区，这限制了硬盘理论最大为255 * 1024 * 63 = 8 GB
	以前最小分区单位为柱面，一个分区为8M 左右，63 * 255 * 512
	现在最小分区单位为扇区，512K
# LBA寻址
	以32位或者64位进行寻址，32位最大能支持2TB硬盘，现在的MBR就是使用这种寻址方式，64位的能支持的更大，GPT分区使用的就是这种
# MBR结构图
![image.png|750](https://lvyusen-1316126434.cos.ap-guangzhou.myqcloud.com/images/202412210329813.png?imageSlim)

	 MBR分区格式的硬盘第一个扇区，512字节，有446字节是启动程序(二进制)，64字节描述分区表，最后两个字节是结束标志
	 64字节里面，分为4个16字节，分别描述4个分区
	 每16个字节里，第一个字节，是描述引导标志，80表示活动分区，00表示非活动分区，第二个字节是头，描述磁头，第三、第四个字节描述磁道和磁盘，第五个字节描述分区类型，0表示未使用，6.7.8字节描述CHS结束位置，跟2.3.4对应起来
	 剩余的8个字节用于LBA，前4个字节描述开始位置，后4个字节描述结束位置
	 逻辑分区EMR也类似于MBR，有512字节，64字节描述逻辑分区的分区表，但只用到32字节，头16个字节描述自己的逻辑分区的开始结束，类似MBR的分区描述，只是MBR后面9-16字节未使用，而EBR是使用的后面9-12个字节作为寻址地址，所以寻址范围就有2^32次方，12-16作为描述扇区大小，最大就是2^32次方，支持2TB,第二个16个字节描述的是下一个逻辑分区的开始位置。

# 硬盘分区表的备份与还原
```bash
1.查看sda的前512字节(MBR)
hexdump -C -n 512 /dev.sda
2.备份分区表
dd if=/dev/sda of=/data/MBR bs=1 count=64 skip=446
3.拷贝到其他主机
scp /data/MBR 10.0.0.210:/data/
4.破坏分区表
dd if=/dev/zero of=/dev/sda bs=1 count=64 seek=446
5.重启进入救援模式
启动时快速按下ESC
6.手动设置地址
ifconfig ens33 10.0.0.200/24
7.拷贝MBR到主机
scp  10.0.0.210:/data/MBR .
8.恢复sda分区表
dd if=MBR of=/dev/sda bs=1 count=64 seek=446
9.使内存数据写入硬盘
sync
```
# GPT分区结构
![1734734331854.png](https://lvyusen-1316126434.cos.ap-guangzhou.myqcloud.com/images/202412210642317.png?imageSlim)
```bash
LBA0 512K MBR保护分区
LBA2 - LBA33 总共32个分区，每个LBA描述4个分区，总共最多能支持128个分区
每个LBA 512字节，其中有8个字节描述分区开始位置，8个字节描述分区结束位置
所以支持的寻址范围 2^64*512 = 9.4ZB
```
	# 不重启识别新硬盘
```bash
echo  "- - -" > /sys/class/scsi_host/host0/scan
```
# 分区命令
## parted
```bash
parted使用需小心，因为是立即生效的
1.设置磁盘分区类型
parted /dev/sdb mklabel gpt|msdos
2.输出硬盘信息
parted /dev/sdb print
3.创建分区
parted /dev/sdb mkpart primary 1 1200
4.删除分区
parted /dev/sdb rm 1
```
## fdisk
[[15-系统管理-磁盘管理#分区三部曲]]
## gdisk
# 文件系统的理解
	文件系统最基础的功能就是对文件进行组织和管理，有了文件系统，磁盘会创建出inode表存储文件对应的元数据，创建block存储文件数据
	而如果没有文件系统，磁盘整块都是以二进制形式对文件内容数据进行存储，如果要取得文件，还得了解文件具体存储在哪个扇区
	而文件系统，通过文件数据结构，对底层数据存储进行抽象，我们不需要了解文件存储在哪个扇区，文件系统会帮我们把文件放在对应文件夹的block内，且会有inode和文件名的映射，取得文件时我们只需要访问文件名，文件系统会找到对应文件名的inode，从而找到对应的block数据
	磁盘内所有的数据都是以二进制形式存储，当我们在shell输入filename时，shell调用系统函数解析路径，通过解析出来的路径找到对应的目录，查找文件名 == inode映射