# 文件系统
## 概念
文件系统是操作系统的子系统，负责将磁盘依旧规则格式化成特定的文件系统类型、如ext2|3|4、fat、xfs等

通俗理解来说，文件系统可以看成是一个图纸，把磁盘按照图纸施工成想要的东西
## 工作内容
较新的操作系统的文件数据除了有实际的数据外，还有非常多的文件属性和权限
文件系统会把磁盘分为三个部分
+ inode
+ block
+ superblock
inode：存放的是文件属性和权限
block：存放的是文件实际数据
superblock：存放的文件系统本身的信息，例如inode总量、block总量、inode使用量、block使用量等等
## 有inode与只有block的比较
例如FAT格式的U盘，就没有inode

也就无法一次性得到block的所有编码，他的block编码存放在上一个block编码内，所以需要一个一个读取

而inode可以一次性知道需要的内容的block编码，磁盘读取只需要一圈就能得到全部的数据

而Fat可能需要好几圈，因为可能读到下面，却发现需要的内容在上面的block里，这就需要重新转一圈
# ext2
## 组成
### boot setor
开机扇区，可以安装开机管理程序，磁盘的第一个扇区MBR和分区表记录，MBR也安装着开机管理程序，而现在分区里面也能安装开机管理程序，这样能够制作多重开机环境
### data block
这是存储文件数据的地方，Ext2设定block只有1K、2K、4K大小
```bash
inode 大小只有 128字节
block 大小可分为 1K 、2K、4K
而block的编号是 4 个字节，所以最大寻址为2^32

1.如果block是1K
最大单一文件大小:12个直接block、一级间接、双级间接、三级间接
12 * 1 k = 12K
256 * 1 k = 256 K
256 * 256 * 1k = 256^2
256 * 256 * 256 * 1k = 256^3
加起来就是16GB
2K 、4K不能这样计算 

最大文件系统大小
2^32 * 1K = 4TB
2^32 * 2K = 8TB
2^32 * 8K = 16TB

```

|          | 1K   | 2K    | 4K   |
| -------- | ---- | ----- | ---- |
| 最大单一文件大小 | 16GB | 256GB | 2TB  |
| 最大文件系统大小 | 4TB  | 8TB   | 16TB |
### inode table
内容
+ 该文件的存储模式
+ 该文件的拥有者和群组
+ 该文件的block编码
+ 该文件的权限属性(atime ctime mtime usid gsid ......)
### super block
存放的文件系统本身的信息，例如inode总量、block总量、inode使用量、block使用量等等，每个block group不一定都含有super block ，如果有，也当第一个的super block的备份
### systemfile descript 
记录block开始结束，以及记录每个组成分别介于哪个区段
### block bitmap
记录哪个block是空的，或者已经使用
### inode bitmap
记录哪个inode是空的，或者已经使用
### dump2fs
查询EXT家族superblock的信息指令
# 链接
## 硬链接
```bash
当创建一个硬链接时，硬链接所在目录的block会添加一条信息 源文件inode : 文件名
说明硬链接是共享inode的，链接文件与源文件都是一样的inode，这不会增加inode和block的使用，当源文件被删除时，只是删除了源文件所在目录的inode：文件名记录，硬链接的inode：文件名记录并不会影响，也就是还能访问到文件数据
```
## 软链接
```bash
当创建一个软链接时，链接所在目录会新增一个文件，该文件的block存储的是源文件的路径
当访问软链接时，会解析文件所存储的路径，例如/etc/passwd
会找到/的inode，从而找到/对应的block，找到etc的inode，再找到etc的block,从而找到passwd的inode，最后找到passwd的block
当移动或删除源文件时，路径解析最后会找不到源文件所在的inode，自然就找不到数据
```
## link数
```bash
link数表示对该文件inode的引用次数
新建文件夹的link为，第一个是父目录的block对新建文件夹的inode的引用，第二个是该文件夹本身block存储的.文件的引用，如果该文件夹内部还有文件夹，则有多少个文件夹就有会有多少个链接数，文件夹内的..是父目录
```
## 软硬链接总结
```bash
1.本质不同，软连接是对目录的解析，硬链接是对inode的引用
2.软连接的源文件，是相对链接文件的目录
/date/f1 源文件
/date/dir/f1 链接文件
如 ln -s ../f1 /date/dir/f1
3.文件类型不同，软连接文件类型是l，硬链接文件类型是-
4.链接数不同，硬链接会增加链接数，软链接是新的文件，新的文件的block存储的是路径
5.功能软连接能跨分区，已经能链接目录，因为他本质是对路径的引用，而硬链接不能跨目录，避免死循环，不能跨分区，因为分区的inode，block都是重新排序的
```