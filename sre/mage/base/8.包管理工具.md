# 概述
```bash
API: application program interface 应用程序编程接口
	是软件之间交互的接口，例如应用程序与库之间的调用规则
	规定了函数名，参数，返回值等，开发者只需按API规范调用函数，就能使用对应的功能，而不用关心内部实现例如 C标准库的printf()就是API
ABI: application binary interface 应用二进制接口
	是二进制级别的接口，描述编译后的程序与操作系统、硬件、库之间的交互规则
	例如x86与ARM架构的ABI不同，所以x86编译的程序不能直接在ARM上跑
	
	
C/C++程序格式:
	源代码: 文本格式的程序代码
		编译开发环境: 编译器、头文件、开发库
	二进制格式: 文本格式的程序代码->编译器->二进制格式(二进制程序、库文件、配置文件、帮助文档)
	
java/python程序格式
	源代码: 编译成能够在其虚拟机(jvm/pvm)运行的格式
		开发环境: 编译器、开发库
	二进制格式
	

```
# 程序包管理器
```bash
程序包管理:
	源代码->目标二进制格式(二进制程序、库文件、配置文件、帮助文件)->组成一个或有限几个"包"文件
		功能: 安装、升级、卸载、查询、校验
		
	程序包管理器
		debian: dpt,dpkg,".deb"
		redhat: redhat package manager,rpm,".rpm"
		S.u.S.E: rpm,".rpm"
		
	源代码: name-VERSION.tar.gz
		VERSION: major.minor.release
	rpm包命名格式
		name-version-release.arch.rpm
			version: major.minor.release
			release.arch: rpm包的发行号
				release.os: 2.el7.i386.rpm
				archetecture: i386,x64(amd64),ppc,noarch
			示例: 	
				redis-3.0.2-1.centos7.x64.rpm
	拆包: 主包和支包
		主包: name-version-release.arch.rpm
		支包: name-function-version-release.arch.rpm
			function: devel,utils,libs...
			
	前端工具: 自动解决依赖关系
		yum: rpm包管理器的前端工具
		apt-get(apt-cache): deb包管理器的前端工具
		zypper: suse的rpm管理前前端工具
		dnf: Fedora 22+系统上rpm包管理器的前端工具
		
		
程序包管理:
	功能: 将编译好的应用程序的各组成文件打包成一个或几个程序包文件，从而更方便实现程序包的安装、升级、卸载和查询等功能
	1.程序包的组成清单(每个程序包都单独实现)
		文件清单
		安装或卸载时运行的脚本
	2.数据库(公共)
		程序包的名称和版本
		依赖关系
		功能说明
		安装生成的个文件的文件路径和检验码信息
		/var/lib/rpm
```
# Centos系统上rpm命令管理程序包
```bash
rpm命令: rpm [options] [package_file]
	安装: -i,--install
	升级: -U,--update
	卸载: -e,--erase
	查询: -q,--query
	校验: -V,--verify
	数据库维护: --buliddb,--initdb
	
	安装:
		rpm {-i|--install} [install-options] package_file
			general options
				-v: verbose，详细信息
				-vv: 更详细的输出
				
			[intall-options]:
				-h: hash marks输出进度条
				--test: 测试安装，检查并报告依赖关系及冲突消息等
				--nodeps: 忽略依赖关系，不建议
				--replacepkgs: 重新安装
				--nosignature: 不检查签名信息，不检查来源合法性
				--nodigest: 不检查包完整性信息
				注意: rpm可以自带脚本
					四类:--noscripts
						preinstall:安装前运行的脚本,%pre,--nopre
						postinstall: 安装完后运行的脚本%post,--nopost
						preunistall: 卸载前运行的脚本,%preun,--nopreun
						postuninstall:卸载后的脚本%postun,--nopostun
						
		升级
			rpm {-U|--upgrade} [install-options] package_file
			rpm {-F|--freshen} [install-options] package_file
				-U: 升级或安装
				-F: 升级
				rpm -Uvh package_file...
				rpm -Fvh package_file...
					--oldpackage: 降级
					--force: 强制升级
			
			注意: 
				1.不要对内核做升级操作，linux支持多内核版本并存
				2.如果某源程序包的配置文件安装后曾修改过，升级时，新版本的程序提供的同一个配置文件不会覆盖原有版本的配置文件，而是把新版本的配置文件重命名(filename.rpmnew)后提供
				
		卸载: 
			rpm {-e|--erase} [--allmatches] [--nodeps] [--test] pk_nam
				--allmatches: 卸载所有匹配指定名称的程序包的个版本
				--nodeps: 忽略依赖关系
				--test: 测试卸载
				
		查询
			rpm {-q|--query} [select-optopns] [query-options]
			[select-options]
				PACKAGE_NAME: 查询指定的程序包是否已经安装，以及版本
				-a,--all: 查询所有已经安装过的包
				-f FILE: 查询指定文件由哪个程序包安装生成
				-p,--package PACKAGE_FILE: 用于实现对未安装的程序包查询
				--whatprovides CAPABILITY: 查询指定的CAPABILITY由哪个程序包提供
				--whatrequires CAPABILITY: 查询指定的CAPABILITY被哪个包依赖
				
			[query-options]
				--changelog: 查询rpm包的changlog
				-l,--list: 程序包安装生成的所有文件列表
				-i,--info: 程序包相关的信息，版本号，大小，所属包组
				-c,--configfiles: 查询指定程序包提供的配置文件
				-d,--docfiles: 查询指定程序包提供的文档
				--provides: 查出指定的程序包的所有CAPABILITY
				-R,--requires: 查询指定程序包的依赖关系
				--scripts: 查看程序包自带的脚本片段
				
			用法:
			-qi package,-qf file,-qc package,-ql package,-qd package
			-qpi package_file,-qpl package_file,-qpc package_file...
			
			
	校验
		rpm {-V|--verify} [select-options] [verify-options]
		
	包来源合法性验证和完整性验证
		来源合法性验证: 公钥验证
		完整性验证，单向加密md512算法
		
		获取并导入信任的包制作者的秘钥
			centos: rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
			
		验证
			1.安装此组织签名的程序时，会自动验证
			2.手动验证: rpm -K package_file
			
			
	数据库重建
		rpm管理器数据库路径: /var/lib/rpm
			查询操作: 通过此处的数据库进行
		获取帮助
			centos6: man rpm
			centos7: man rpmdb
			rpm {--initdb|--rebuilddb} [--dbpath dir] [--root dir]
				--initdb: 初始化数据库，当前无任何数据库可初始化创建一个新的，当前有则不执行任何操作
				--rebuilddb: 重新构建,通过读取当前系统上所有已经安装过的程序包进行重建
				
```
yum
```bash
yum [options] [command] [package...]

显示仓库列表
	yum repolist [all|enabled|disabled]
	
显示程序包
	yum list
	
安装程序包
	yum install package1 package2
	
检查可用升级
	yum check-update
	
卸载程序包
	yum remove | erase package
	
查看程序包information
	yum info [...]
	
查看指定的特性(可以是某文件)是由哪个程序包所提供
	yum provides feature1
	
清理本地缓存
	yum clean 
	
构建缓存
	yum makecache
	
搜索
	yum search string1
	以指定的关键字搜索程序包及summary信息
	
查看指定包所依赖的capabilities
	yum deplist package1
	
查看yum事物历史
	yum history 
	
安装及升级本地程序包
	yum install rpmfile1
	
包组管理相关命令
	yum group install group1
	yum group update group1
	yum group list
	yum gourp remove
	yum group info group
	yum search string

yum的命令行选项
	--nogpgcheck: 禁止进行gpg check
	-y: 自动回答yes
	-q: 静默模式
	--disablerepo=repoidglob: 临时禁用此处指定的repo
	--enablerepo=repoidglob: 临时启用此处指定的repo
	--noplugins: 禁用所有插件
	
yum的repo配置文件中可用的变量
	$releasever: 当前OS的发行版的主版本号
	$arch: 平台
	$basearch: 基础平台
	$YUM0-$YUM9
	
插件yum仓库
	yum createrepo [options] <directory>
```
# 编译安装
```bash
程序包编译安装
	testapp-varsion-release.src.rpm -->安装后，使用rpmbuild命令制作成二进制格式的rpm包，而后再安装
	源代码-->预处理-->编译(gcc)-->汇编-->链接-->执行
	
	源代码组织格式
		多文件: 文件中的代码之间，很可能存在跨文件依赖关系
		
		C、C++: make
		java: maven
		
	编译安装三步骤
		./confiugre
			1.通过选项传递参数，指定启用特性、安装路径等.执行时会参考用户的指定以及Makefile.in文件生成makefile
			2.检查依赖到的外部环境
		make
			根据makefile文件，构建应用程序
		make install 
		
	开发工具
		autoconf: 生成configure脚本
		automake: 生成Makefile.in
		
		
	编译C源代码
		前提: 提供开发工具及开发环境
			开发工具: make,gcc等
			开发环境: 开发库，头文件
				glibc: 标准库
				
			通过“包组”提供开发组件
				Centos6: "Development Tools", "Server Platform Develpment"
				
		第一步: configure脚本
			选项: 指定安装位置、指定启用特性
			--help: 获取其支持使用的选项
				选项分类
					安装路径设定
						--prefix=/path/to/dir: 指定默认按照位置,默认为/usr/local/
						--sysconfdir=/path/to/dir: 配置文件安装位置
						
					System types: 系统类型
					
					Optional Features: 可选特性
						--disable-FEATURE
						--enable-FFATURE[=ARG]
						
					Optional Packages: 可选包
						--with-PACKAGE[=AGE]
						
		第二步: make
		第三步: make install
		
		安装后的配置
			1.导出二进制程序目录至PATH环境变量中
				编辑文件/etc/profile.d/NAME.sh
					export PATH=/PATH/TO/BIN:$PATH
					
			2.导出库文件路径
				编辑/etc/ld.so.conf.d/NAME.conf
					添加新的库文件所在目录至此文件中
					
					让系统重新生成缓存
						ldconfig [-V]
						
			3.导出头文件
				ln -sv
			
			4.导出帮助手册
				编辑/etc/man.config文件
					添加一个MANPATH
					
练习
	1.yum的配置和使用,包括yum repository的创建
	2.编译安装apache 2.2,启动此服务
```